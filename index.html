<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title> Forest Loss in Sri Lanka</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    #map { height: 80vh; width: 100%; }
    #chart-container { width: 100%; padding: 10px; background: #fff; }
    canvas { max-width: 100%; }
  </style>
</head>
<body>

  <h2 style="text-align:center;"> Forest Loss in Districts- SriLanka </h2>
  <div id="map"></div>
  <div id="chart-container">
    <canvas id="lossChart"></canvas>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- PapaParse for CSV -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>

  <script>
    // Initialize the map
    const map = L.map('map').setView([8.6, 79.9], 8);

    // ✅ Label-free base map (dark, no roads/labels)
    L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png', {
      maxZoom: 18,
      attribution: '&copy; Stadia Maps, &copy; OpenMapTiles'
    }).addTo(map);

    // Add district GeoJSON
    fetch('data/sri_lanka_districts.geojson')
      .then(res => res.json())
      .then(data => {
        L.geoJSON(data, {
          style: {
            color: '#00e676',
            weight: 2,
            fillColor: '#1b5e20',
            fillOpacity: 0.3
          },
          onEachFeature: (feature, layer) => {
            const name = feature.properties?.DISTRICT || "Unknown District";
            layer.bindPopup(`<strong>${name}</strong>`);
          }
        }).addTo(map);
      });

    // Load CSV forest loss data
    fetch('data/district_forest_loss_Srilanka.csv')
      .then(res => res.text())
      .then(csvText => {
        const parsed = Papa.parse(csvText, { header: true });
        const data = parsed.data;

        const districts = data.map(row => row.District);
        const losses = data.map(row => parseFloat(row.ForestLoss));

        // Draw bar chart
        new Chart(document.getElementById('lossChart').getContext('2d'), {
          type: 'bar',
          data: {
            labels: districts,
            datasets: [{
              label: 'Forest Loss (hectares)',
              data: losses,
              backgroundColor: 'rgba(255, 99, 132, 0.7)'
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: false },
              title: {
                display: true,
                text: 'Forest Loss per District'
              }
            },
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
      });

    // ✅ OPTIONAL: Add Raster TIF if tiled and hosted
    // const raster = L.tileLayer('tiles/your_tif_folder/{z}/{x}/{y}.png', {
    //   attribution: 'TIF Data',
    //   opacity: 0.6
    // }).addTo(map);

  </script>
</body>
</html>
